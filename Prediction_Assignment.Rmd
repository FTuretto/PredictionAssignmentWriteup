---
title: "Prediction Assignment Writeup"
author: "Fabio Turetto Rodrigues"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Background

This project aims to predict the manner in which participants performed exercises using data from accelerometers on their belt, forearm, arm, and dumbbell. The target variable is `classe`, which categorizes the type of movement performed.

## Load Packages

```{r load-packages}
library(caret)
library(randomForest)
library(gbm)
library(knitr)
```

## Load Data

```{r load-data}
training_url <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"
testing_url <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv"

training <- read.csv(training_url, na.strings = c("NA", "", "#DIV/0!"))
testing <- read.csv(testing_url, na.strings = c("NA", "", "#DIV/0!"))
```

## Data Preprocessing

```{r preprocessing}
# Removing columns with too many NAs
training <- training[, colSums(is.na(training)) == 0]
testing <- testing[, colSums(is.na(testing)) == 0]

# Removing non-relevant columns (like IDs)
training <- training[, -c(1:7)]
testing <- testing[, -c(1:7)]

# Splitting into training and validation sets
set.seed(1234)
inTrain <- createDataPartition(training$classe, p = 0.75, list = FALSE)
trainSet <- training[inTrain, ]
validSet <- training[-inTrain, ]

# Convertendo a variÃ¡vel 'classe' para fator
trainSet$classe <- as.factor(trainSet$classe)
validSet$classe <- as.factor(validSet$classe)
```

## Model Training

### Random Forest Model

```{r rf-model}
set.seed(1234)
rf_model <- randomForest(classe ~ ., data = trainSet, importance = TRUE)
pred_rf <- predict(rf_model, validSet)
rf_accuracy <- confusionMatrix(pred_rf, validSet$classe)
rf_accuracy$overall["Accuracy"]
```

### Optimized Boosted Trees Model (GBM)

```{r gbm-model}
set.seed(1234)
gbm_model <- train(classe ~ ., data = trainSet, method = "gbm", 
                   trControl = trainControl(method = "cv", number = 3), 
                   verbose = FALSE, 
                   tuneGrid = expand.grid(interaction.depth = 3, 
                                          n.trees = 100, 
                                          shrinkage = 0.1, 
                                          n.minobsinnode = 10))
pred_gbm <- predict(gbm_model, validSet)
gbm_accuracy <- confusionMatrix(pred_gbm, validSet$classe)
gbm_accuracy$overall["Accuracy"]
```

## Model Evaluation

```{r evaluation}
kable(data.frame(
  Model = c("Random Forest", "GBM"),
  Accuracy = c(rf_accuracy$overall["Accuracy"], gbm_accuracy$overall["Accuracy"])
))
```

## Predictions on Test Data

```{r test-predictions}
pred_test <- predict(rf_model, testing)
write.csv(pred_test, file = "predictions.csv", row.names = FALSE)
```

## Conclusion

This report summarizes the approach used for training predictive models to classify movement types. The Random Forest model performed better and was used for final predictions.
